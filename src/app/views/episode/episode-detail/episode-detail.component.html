<div *ngIf="loading; else Content">
  <p>Loading...</p>
</div>

<ng-template #Content>

  <ng-container *ngIf="episode">

    <div class="episode">

      <picture *ngIf="episode.image.url">
        <source [srcset]="episode.image.size['medium']" media="(max-width: 424px)">
        <source [srcset]="episode.image.size['medium_large']" media="(min-width: 425px) and (max-width: 639px)">
        <source [srcset]="episode.image.size['2048x2048']" media="(min-width: 640px)">
        <img [src]="episode.image.size['medium_large']" [alt]="episode.image.alt" />
      </picture>

      <div class="content">

        <div class="main">

          <h1 class="title">{{ episode.title }}</h1>

          <div class="meta">
            <div class="location-date">
              <span *ngIf="episode.location">{{ episode.location }}, </span><span class="date">{{ episode.date | date}}</span>
            </div>

            <div class="producers" *ngIf="episode.producers">
              <span>With: </span>
              <ng-container *ngFor="let producer of episode.producers; let last = last">
                <a class="underline" [routerLink]="['/producer', producer.id]">{{ producer.name }}<ng-container *ngIf="!last">,</ng-container></a>
              </ng-container>
            </div>
          </div>

          <app-episode-audio-controls [episode]="episode" [currentOnDemandStream$]="currentOnDemandStream$"
            [onDemandStreamLoading$]="onDemandStreamLoading$" [onDemandStreamPlaying$]="onDemandStreamPlaying$">
          </app-episode-audio-controls>

          <div class="description" *ngIf="episode.content" [innerHTML]="episode.content"></div>
        
          <ul class="genres" *ngIf="episode.genres">
            <li class="genre" *ngFor="let genre of episode.genres">
              <a [routerLink]="['/genre', genre.id]">{{ genre.name }}</a>
            </li>
          </ul>

          <div class="show" *ngIf="episode.shows && episode.shows.length > 0">
            <a [routerLink]="['/show', episode.shows[0].id]">Find more</a>
          </div>

        </div>

        <div class="tracklist" *ngIf="episode.tracklists && episode.tracklists.length > 0">
          <h2 class="title">Tracklist</h2>
          <ul class="tracks">
            <li class="track" *ngFor="let track of episode.tracklists[0].tracks">
              <div class="artist" *ngFor="let artist of track.artistsTerms; let last = last">
                <a [routerLink]="['/artist', artist.id]">{{ artist.name }}<ng-container *ngIf="!last">,</ng-container></a>
              </div>
              <div class="title">{{ track.title }}</div>
              <div class="name">{{ track.artistName }}</div>
            </li>
          </ul>
        </div>

        <div class="footer">
          <button (click)="goBack()">Back</button>
        </div>

      </div>
    </div>

    <!-- Relate Episodes -->

    <app-episode-related-list [currentOnDemandStream$]="currentOnDemandStream$"
      [onDemandStreamLoading$]="onDemandStreamLoading$" [onDemandStreamPlaying$]="onDemandStreamPlaying$"
      [episodes]="relatedEpisodes">
    </app-episode-related-list>

  </ng-container>

</ng-template>