<ng-container *ngIf="isLoading; else content">
    <ng-template #loading>
        <p>Loading...</p>
    </ng-template>
</ng-container>

<ng-template #content>

    <div *ngIf="episode">

        <h1>{{ episode.title.rendered }}</h1>
        <div [innerHTML]="episode.content.rendered"></div>
        <div>
            <label>Air Date:</label> {{ episode.date | date }}
        </div>

        <div class="play-container">
            <div *ngIf="episode.acf?.track" class="play-controls" (click)="playEpisode(episode)">
                <span
                    *ngIf="(currentOnDemandStream$ | async)?.id === episode.id && (onDemandStreamPlaying$ | async) && !(onDemandStreamLoading$ | async)"
                    class="material-symbols-outlined symbol">pause</span>
                <span
                    *ngIf="(currentOnDemandStream$ | async)?.id !== episode.id || (currentOnDemandStream$ | async)?.id === episode.id && !(onDemandStreamPlaying$ | async) && !(onDemandStreamLoading$ | async)"
                    class="material-symbols-outlined symbol">play_arrow</span>
                <div *ngIf="(currentOnDemandStream$ | async)?.id === episode.id && (onDemandStreamLoading$ | async)"
                    class="spinner-container">
                    <div class="spinner"></div>
                </div>
            </div>

        </div>

        <button (click)="goBack()">Go Back</button>

        <!-- Display Artists -->
        <ng-container *ngIf="episode.artist && episode.artist.length > 0">
            <ul>
                <li *ngFor="let artistId of episode.artist">
                    <ng-container *ngIf="getEpisodeArtist(artistId) as artist">
                        <a [routerLink]="['/artist', artist.id]">{{ artist.name }}</a>
                    </ng-container>
                </li>
            </ul>
        </ng-container>

        <!-- Display genres -->
        <ng-container *ngIf="episode.genre && episode.genre.length > 0">
            <ul>
                <li *ngFor="let genreId of episode.genre">
                    <ng-container *ngIf="getEpisodeGenre(genreId) as genre">
                        <a [routerLink]="['/genre', genre.id]">{{ genre.name }}</a>
                    </ng-container>
                </li>
            </ul>
        </ng-container>

        <!-- Display Artists and their episodes -->
        <ng-container *ngIf="episode?.artist && episode.artist.length > 0">
            <h3>All Episodes by Associated Artists:</h3>
            <ul *ngFor="let artistId of episode.artist">
                <li *ngFor="let artistEpisode of getArtistEpisodes(artistId)">
                    <div class="play-container">
                        <div *ngIf="artistEpisode.acf?.track" class="play-controls"
                            (click)="playEpisode(artistEpisode)">
                            <span
                                *ngIf="(currentOnDemandStream$ | async)?.id === artistEpisode.id && (onDemandStreamPlaying$ | async) && !(onDemandStreamLoading$ | async)"
                                class="material-symbols-outlined symbol">pause</span>
                            <span
                                *ngIf="(currentOnDemandStream$ | async)?.id !== artistEpisode.id || (currentOnDemandStream$ | async)?.id === artistEpisode.id && !(onDemandStreamPlaying$ | async) && !(onDemandStreamLoading$ | async)"
                                class="material-symbols-outlined symbol">play_arrow</span>
                            <div *ngIf="(currentOnDemandStream$ | async)?.id === artistEpisode.id && (onDemandStreamLoading$ | async)"
                                class="spinner-container">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>

                    <a [routerLink]="['/episode', episode.id]">
                        <p>{{ artistEpisode.date | date }}</p>
                        <h2>{{ artistEpisode.title.rendered }}</h2>
                        <p [innerHTML]="artistEpisode.excerpt.rendered"></p>
                    </a>

                    <!-- Display Artists -->
                    <ng-container *ngIf="artistEpisode.artist && artistEpisode.artist.length > 0">
                        <ul>
                            <li *ngFor="let artistId of artistEpisode.artist">
                                <ng-container *ngIf="getEpisodeArtist(artistId) as artist">
                                    <a [routerLink]="['/artist', artist.id]">
                                        <strong>{{ artist.name }}</strong>
                                    </a>: {{ artist.description }}
                                </ng-container>
                            </li>
                        </ul>
                    </ng-container>

                    <!-- Display genres -->
                    <ng-container *ngIf="artistEpisode.genre && artistEpisode.genre.length > 0">
                        <ul>
                            <li *ngFor="let genreId of artistEpisode.genre">
                                <ng-container *ngIf="getEpisodeGenre(genreId) as genre">
                                    <a [routerLink]="['/genre', genre.id]">
                                        <strong>{{ genre.name }}</strong>
                                    </a>: {{ genre.description }}
                                </ng-container>
                            </li>
                        </ul>
                    </ng-container>
                </li>
            </ul>
        </ng-container>


    </div>
</ng-template>